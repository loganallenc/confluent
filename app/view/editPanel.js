Ext.define("Docket.view.editPanel",{extend:"Ext.form.Panel",requires:["Docket.view.timeSlider","Ext.field.TextArea","Ext.field.DatePicker","Ext.picker.Date","Ext.Button","Ext.field.Slider","Ext.Label","Ext.Toolbar"],config:{centered:true,height:"90%",id:"editPanel",submitted:false,originalEvent:{},itemId:"editPanel",width:"90%",hideOnMaskTap:true,modal:true,hideAnimation:{type:"fadeOut",duration:100},showAnimation:{type:"fadeIn",duration:100},items:[{xtype:"textfield",cls:"eventTitle",itemId:"eventTitle",placeHolder:"Summary"},{xtype:"textareafield",cls:"eventDescription",itemId:"eventDescription",placeHolder:"Description",autoCapitalize:true},{xtype:"datepickerfield",itemId:"datepicker",placeHolder:"Date: ",picker:{itemId:"picker"}},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:"75%",items:[{xtype:"timeSlider",listeners:{change:function(e){var t=e.getValue()/2;var n=(t-parseInt(t))*60;var r=" am";t=parseInt(t);if(t==24){t=11;n=59;r=" pm"}else if(t>12){t=t-12;r=" pm"}else if(t==12){r=" pm"}if(t<10){t="0"+t}if(n===0){n="00"}var i=document.getElementsByClassName("startLabel")[0];i.innerText=t+":"+n+r}},label:"",labelWidth:0}]},{xtype:"label",cls:"startLabel",html:"12:00 am",itemId:"startLabel",padding:"20 0 0 0",style:"background:#FFF; color: #555; font-size:90%;",width:"25%"}]},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:"75%",items:[{xtype:"timeSlider",listeners:{change:function(e){var t=e.getValue()/2;var n=(t-parseInt(t))*60;var r=" am";t=parseInt(t);if(t==24){t=11;n=59;r=" pm"}else if(t>12){t=t-12;r=" pm"}else if(t==12){r=" pm"}if(t<10){t="0"+t}if(n===0){n="00"}var i=document.getElementsByClassName("endLabel")[0];i.innerText=t+":"+n+r}},label:"",labelWidth:0}]},{xtype:"label",cls:"endLabel",html:"12:00 am",itemId:"endLabel",padding:"20 0 0 0",style:"background:#FFF; color: #555; font-size:90%;",width:"25%"}]},{xtype:"textareafield",cls:"eventGuest",placeHolder:"Guests",listeners:{focus:function(e){var t=Ext.getCmp("formPanel");window.setTimeout(function(){t.getScrollable().getScroller().scrollToEnd()},800)}}},{xtype:"toolbar",docked:"bottom",width:"100%",layout:{type:"hbox",pack:"center"},items:[{xtype:"button",ui:"confirm",width:"40%",text:"Cancel",handler:function(e,t){var n=this,r=n.getParent().getParent();r.hide()}},{xtype:"button",handler:function(e,t){function w(e){var t=e.getHours(),n=e.getMinutes(),r=e.getMonth()+1,i=e.getDate(),s=e.getTimezoneOffset()/60*-1;if(t<10){t="0"+t}if(n<10){n="0"+n}if(r<10){r="0"+r}if(i<10){i="0"+i}if(s>0){s="+"+s}if(s<10||s>-10){s=s.toString();s=s.substring(0,1)+"0"+s.substring(1)}return e.getFullYear()+"-"+r+"-"+i+"T"+t+":"+n+":00.000"+s+":00"}var n=this,r=document.getElementsByClassName("x-input-text")[0].value,i=document.getElementsByClassName("x-input-text")[1].value,s=document.getElementsByClassName("x-input-text")[3].value,o=document.getElementsByClassName("startLabel")[0].innerHTML,u=document.getElementsByClassName("endLabel")[0].innerHTML,a=Ext.ComponentQuery.query("#mainCarousel")[0],f=a.getActiveItem(),l=f.calendarId,c=f.roomText,h=new Date,p=new Date,d="",v;n.disable();var m=Docket.app.authToken,g="464168127252.apps.googleusercontent.com",y="AIzaSyAy7JAsd5JlzjTR_fkkarby9N1c3YkhY6o",b="https://www.googleapis.com/auth/calendar";try{v=Ext.ComponentQuery.query("#picker")[0].getValue()}catch(E){v=new Date}h.setDate(v.getDate());h.setMonth(v.getMonth());h.setFullYear(v.getFullYear());hours=parseInt(o.substring(0,2),10);minutes=parseInt(o.substring(3,5),10);if(hours.toString()=="NaN"){hours=0}if(minutes.toString()=="NaN"){minutes=0}if(o.substring(6,8)=="pm"&&hours!=12){hours=hours+12}h.setHours(hours);h.setMinutes(minutes);h.setSeconds(0);p.setDate(v.getDate());p.setMonth(v.getMonth());p.setFullYear(v.getFullYear());hours=parseInt(u.substring(0,2),10);minutes=parseInt(u.substring(3,5),10);if(hours.toString()=="NaN"){hours=0}if(minutes.toString()=="NaN"){minutes=0}if(u.substring(6,8)=="pm"&&hours!=12){hours=hours+12}p.setHours(hours);p.setMinutes(minutes);p.setSeconds(0);o=w(h);u=w(p);var S={summary:r,description:i,location:c,start:{dateTime:o},end:{dateTime:u},attendees:[]};s=s.replace(/(\r\n|\n|\r)/gm,"");s=s.replace(/\s+/g,"");s=s.split(",");for(var x=0;x<s.length;x++){d=s[x];if(d!==""){d=d.split("@");if(d.length>1){S.attendees.push({email:d[0]+"@"+d[1],displayName:d[0],responseStatus:"needsAction"})}}}try{gapi.client.setApiKey(y);gapi.auth.setToken(m)}catch(E){window.location.reload()}gapi.auth.authorize({client_id:g,scope:b,immediate:true},function(e){if(e){gapi.client.load("calendar","v3",function(){var e=gapi.client.calendar.events.update({calendarId:l,eventId:eventId,resource:S});e.execute(function(e){if(e.id){var t=Ext.ComponentQuery.query("#mainCarousel")[0],r=t.getActiveItem();n.getParent().getParent().hide();setTimeout(function(){r.reloadRequest.call(r)},2500)}else{alert("There was an error while adding your event.")}})})}})},ui:"confirm",width:"40%",text:"Add"}]}],listeners:[{fn:"onFormPanelHide",event:"hide"}]},onFormPanelHide:function(e,t){window.setTimeout(function(){e.destroy()},2500)},initialize:function(){this.callParent();this.down("#datepicker").setValue(new Date)},painted:function(){var e=document.getElementsByClassName("x-input-text")[0].value,t=document.getElementsByClassName("x-input-text")[1].value,n=document.getElementsByClassName("x-input-text")[3].value,r=document.getElementsByClassName("startLabel")[0].innerHTML,i=document.getElementsByClassName("endLabel")[0].innerHTML;console.log(this.originalEvent)}})